<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><title>WOQL Query Guide in Python - Graph Database Documentation</title><link rel="shortcut icon" href="/docs/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/docs/assets/css/just-the-docs.css"><link href="https://fonts.googleapis.com/css?family=Lexend+Deca&display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Poppins&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.9/css/all.css" integrity="sha384-5SOiIsAziJl6AWe0HWRKTXlfcSHKmYV4RBF18PPJ173Kzn7jzMyFuTtk8JA7QQG1" crossorigin="anonymous"> <script type="text/javascript" src="/docs/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/docs/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>WOQL Query Guide in Python | Graph Database Documentation</title><meta name="generator" content="Jekyll v3.8.7" /><meta property="og:title" content="WOQL Query Guide in Python" /><meta property="og:locale" content="en_US" /><meta name="description" content="TerminusDB - Quick start tutorials and how to’s for the graph database management system" /><meta property="og:description" content="TerminusDB - Quick start tutorials and how to’s for the graph database management system" /><link rel="canonical" href="/docs/how-tos/python/query-guide-python/" /><meta property="og:url" content="/docs/how-tos/python/query-guide-python/" /><meta property="og:site_name" content="Graph Database Documentation" /> <script type="application/ld+json"> {"description":"TerminusDB - Quick start tutorials and how to’s for the graph database management system","@type":"WebPage","url":"/docs/how-tos/python/query-guide-python/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://terminusdb.com/img/logos/logo.svg"}},"headline":"WOQL Query Guide in Python","@context":"https://schema.org"}</script> <script async defer src="https://scripts.simpleanalyticscdn.com/latest.js"></script> <noscript><img src="https://queue.simpleanalyticscdn.com/noscript.gif" alt=""/></noscript> <script> var _paq = window._paq || []; /* tracker methods like "setCustomDimension" should be called before "trackPageView" */ _paq.push(['disableCookies']); _paq.push(['trackPageView']); _paq.push(['enableLinkTracking']); (function() { var u="https://terminusdb.matomo.cloud/"; _paq.push(['setTrackerUrl', u+'matomo.php']); _paq.push(['setSiteId', '1']); var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript'; g.async=true; g.defer=true; g.src='//cdn.matomo.cloud/terminusdb.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s); })(); </script><body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="link" viewBox="0 0 16 16"><title>Link</title><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path> </symbol> </svg><div class="page-wrap"><div class="side-bar"><div class="site-header"> <a href="https://terminusdb.com" class="site-title lh-tight"><div class="site-logo"></div></a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button></div><div class="navigation main-nav js-main-nav"><nav role="navigation" aria-label="Main navigation"><ul class="navigation-list"><li class="navigation-list-item active"> <a href="https://terminusdb.com/documentation" class="navigation-list-link active">Home</a><li class="navigation-list-item"><li class="navigation-list-item"><li class="navigation-list-item"><a href="/docs/tutorials" class="navigation-list-link">Tutorials</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="/docs/tutorials/clone-tutorial/" class="navigation-list-link">My First Cloned Database</a><li class="navigation-list-item "><a href="/docs/tutorials/share-tutorial/" class="navigation-list-link">My First Shared Database</a><li class="navigation-list-item "><a href="/docs/tutorials/push-pull-tutorial/" class="navigation-list-link">Pushing and Pulling Changes</a><li class="navigation-list-item "><a href="/docs/tutorials/branch-tutorial/" class="navigation-list-link">Creating and Merging Branches</a><li class="navigation-list-item "><a href="/docs/tutorials/knowledge-graph/" class="navigation-list-link">Taking TerminusDB to the Bank</a><li class="navigation-list-item "><a href="/docs/tutorials/csv-tutorial/" class="navigation-list-link">Importing and Cleaning Data From CSVs</a></ul><li class="navigation-list-item"><a href="/docs/reference/" class="navigation-list-link">Reference</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="/docs/reference/server" class="navigation-list-link">Server</a><li class="navigation-list-item "><a href="/docs/reference/js-client/" class="navigation-list-link">JS Client</a><li class="navigation-list-item "><a href="/docs/reference/python-client/" class="navigation-list-link">Python Client</a><li class="navigation-list-item "><a href="/docs/reference/bootstrap" class="navigation-list-link">Bootstrap</a><li class="navigation-list-item "><a href="/docs/reference/web-components" class="navigation-list-link">Console</a><li class="navigation-list-item "><a href="/docs/reference/woql" class="navigation-list-link">WOQL.js - the Definitive Guide</a></ul><li class="navigation-list-item active"><a href="/docs/how-tos" class="navigation-list-link">How Tos</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="/docs/how-tos/installation/" class="navigation-list-link">Installation</a><li class="navigation-list-item "><a href="/docs/how-tos/other-install/" class="navigation-list-link">Other ways of installing TerminusDB</a><li class="navigation-list-item "><a href="/docs/how-tos/manage-collaborators/" class="navigation-list-link">Manage Collaborators</a><li class="navigation-list-item "><a href="/docs/how-tos/synchronise/" class="navigation-list-link">Synchronising Changes</a><li class="navigation-list-item "><a href="/docs/how-tos/time-travel/" class="navigation-list-link">Time Travel</a><li class="navigation-list-item "><a href="/docs/how-tos/branch/" class="navigation-list-link">Create and Merge Branches</a><li class="navigation-list-item "><a href="/docs/how-tos/import-data/" class="navigation-list-link">Import and Clean CSV Data</a><li class="navigation-list-item "><a href="/docs/how-tos/query/" class="navigation-list-link">Query</a><li class="navigation-list-item "><a href="/docs/how-tos/schema/" class="navigation-list-link">Create Schema</a><li class="navigation-list-item active"><a href="/docs/how-tos/python" class="navigation-list-link">Python How Tos</a><ul class="navigation-list-grand-child-list"><li class="navigation-list-item active"> <a href="/docs/how-tos/python/query-guide-python/" class="navigation-list-link active">WOQL Query Guide in Python</a><li class="navigation-list-item "> <a href="/docs/how-tos/python/branch-python/" class="navigation-list-link">Create and Merge Branches in Python</a><li class="navigation-list-item "> <a href="/docs/how-tos/python/import-data-python/" class="navigation-list-link">Import and Clean Data in Python</a></ul><li class="navigation-list-item "><a href="/docs/how-tos/beta/" class="navigation-list-link">Accessing TerminusHub with Bootstrap - Certificate Help</a></ul><li class="navigation-list-item"><a href="/docs/discussion" class="navigation-list-link">Discussion</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="/docs/discussion/baisc/" class="navigation-list-link">Basic Ideas</a><li class="navigation-list-item "><a href="/docs/discussion/collaboration/" class="navigation-list-link">Collaboration</a><li class="navigation-list-item "><a href="/docs/discussion/branch/" class="navigation-list-link">Branching and Merging</a><li class="navigation-list-item "><a href="/docs/discussion/storage/" class="navigation-list-link">Storage</a><li class="navigation-list-item "><a href="/docs/discussion/data-model/" class="navigation-list-link">Data Modeling</a><li class="navigation-list-item "><a href="/docs/discussion/query/" class="navigation-list-link">Querying</a><li class="navigation-list-item "><a href="/docs/discussion/reserach/" class="navigation-list-link">Research Papers</a></ul><li class="navigation-list-item"><a href="/docs/release-notes/" class="navigation-list-link">Release notes</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="/docs/release-notes/upgrade/" class="navigation-list-link">Upgrade</a></ul><li class="navigation-list-item"><a href="/docs/frequently-asked-questions/" class="navigation-list-link">FAQs</a></ul></nav></div><footer class="site-footer"><p class="text-small text-grey-dk-000 mb-4">This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</p></footer></div><div class="main-content-wrap js-main-content" tabindex="0"><div class="main-content"><div class="page-header js-page-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Graph Database Documentation" aria-label="Search Graph Database Documentation" autocomplete="off"> <label for="search-input" class="search-label"> <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg> </label></div><div id="search-results" class="search-results"></div></div></div><header class="header header--dark"><div class="wrapper wrapper--increased"><nav class="menu"><div class="menu__body"><ul class="menu__list"><li class="menu__item"> <a href="https://terminusdb.com/documentation/" target="_self" class="menu__link menu__link--active" aria-label="Documentation"> Documentation </a><li class="menu__item"> <a href="https://terminusdb.com/community/" target="_self" class="menu__link " aria-label="Community"> Community </a><li class="menu__item"> <a href="https://terminusdb.com/blog/" target="_self" class="menu__link" aria-label="Blog"> Blog </a><li class="menu__item"> <a href="https://terminusdb.com/hub/" target="_self" class="menu__link" aria-label="Blog"> Terminus Hub </a><li class="menu__item menu__item--full-devices"><ul class="menu__social-list"><li class="menu__social-item"> <a href="https://twitter.com/TerminusDB" class="menu__social-link" target="_blank"> <i class="icon-twitter menu__icon"></i> </a><li class="menu__social-item"> <a href="https://github.com/terminusdb/terminusdb-server" class="menu__social-link" target="_blank" aria-label="Github link"> <i class="icon-github-logo menu__icon"></i> </a><li class="menu__social-item"><a href="https://www.youtube.com/channel/UC5kZt8pP-FM0u-R0BQr78YA/featured" class="menu__social-link" target="_blank"><i class="icon-youtube menu__icon"></i></a><li class="menu__social-item"><a href="https://www.linkedin.com/company/terminusdb/" class="menu__social-link" target="_blank"><i class="icon-linkedin menu__icon"></i></a></ul><li class="menu__item menu__item--full-devices"> <a href="https://terminusdb.com/hub/download" target="_self" class="menu__button" aria-label="Download center"> Download Center </a></ul><ul class="menu__footer"><li class="menu__secondary-item"> <a href="https://terminusdb.com" role="button"> <img src="https://terminusdb.com/img/logos/logo.svg" class="menu__secondary-logo" alt="Terminus DB logo"> </a><li class="menu__secondary-item"><p class="menu__copyright"> ©2020 - TerminusDB | All right reserved</p></ul></div><button id="burger" class="menu__burger" role="button" aria-label="Navigation burger button"> <span></span> <span></span> <span></span> </button></nav></div></header><div class="page"><nav class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="/docs/how-tos">How Tos</a><li class="breadcrumb-nav-list-item"><a href="/docs/how-tos/python">Python How Tos</a><li class="breadcrumb-nav-list-item"><span>WOQL Query Guide in Python</span></ol></nav><div id="main-content" class="page-content" role="main"><h1 class="no_toc" id="woql-query-guide-in-python"> <a href="#woql-query-guide-in-python" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> WOQL Query Guide in Python</h1><h2 class="no_toc text-delta" id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Table of contents</h2><ol id="markdown-toc"><li><a href="#get-an-edge" id="markdown-toc-get-an-edge">Get an Edge</a><li><a href="#connect-the-dots" id="markdown-toc-connect-the-dots">Connect the dots</a><li><a href="#paths" id="markdown-toc-paths">Paths</a><li><a href="#updates-and-inserts" id="markdown-toc-updates-and-inserts">Updates and Inserts</a><li><a href="#casting" id="markdown-toc-casting">Casting</a><li><a href="#string-matching" id="markdown-toc-string-matching">String Matching</a><li><a href="#string-manipulation" id="markdown-toc-string-manipulation">String manipulation</a><li><a href="#mathematics" id="markdown-toc-mathematics">Mathematics</a><li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></ol><hr /><h2 id="get-an-edge"> <a href="#get-an-edge" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Get an Edge</h2><p>TerminusDB is a graph database, so we represent all data as edges. An edge is either a link from one node to another or a link from a node to some data.</p><p>In order to query data, we need to first have some data to query. You can get a <em>fairly big</em> database by running the following database by cloning using the following script (Note: this might take a few minutes as DBPedia is quite large!)</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">terminusdb_client</span> <span class="kn">import</span> <span class="n">WOQLClient</span>
<span class="kn">from</span> <span class="nn">terminusdb_client</span> <span class="kn">import</span> <span class="n">WOQLQuery</span> <span class="k">as</span> <span class="n">WQ</span>

<span class="n">server_url</span> <span class="o">=</span> <span class="s">"https://127.0.0.1:6363"</span>
<span class="n">db</span> <span class="o">=</span> <span class="s">"dbpedia"</span>
<span class="n">user</span> <span class="o">=</span> <span class="s">"admin"</span>
<span class="n">account</span> <span class="o">=</span> <span class="s">"admin"</span>
<span class="n">key</span> <span class="o">=</span> <span class="s">"root"</span>
<span class="n">remote_database</span> <span class="o">=</span> <span class="s">"https://hub.terminusdb.com/gavin/dbpedia"</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">WOQLClient</span><span class="p">(</span><span class="n">server_url</span><span class="p">)</span>
<span class="n">client</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">account</span><span class="o">=</span><span class="n">account</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="p">)</span>

<span class="n">new_db</span> <span class="o">=</span> <span class="s">"dbpedia_copy"</span>
<span class="n">client</span><span class="p">.</span><span class="n">remote_auth</span><span class="p">({</span> <span class="s">"type"</span> <span class="p">:</span> <span class="s">"basic"</span><span class="p">,</span>
                     <span class="s">"user"</span> <span class="p">:</span> <span class="n">user</span><span class="p">,</span>
                     <span class="s">"key"</span> <span class="p">:</span> <span class="n">key</span><span class="p">})</span>
<span class="n">client</span><span class="p">.</span><span class="n">clonedb</span><span class="p">({</span> <span class="s">"remote_url"</span> <span class="p">:</span> <span class="s">f"</span><span class="si">{</span><span class="n">remote_database</span><span class="si">}</span><span class="s">"</span><span class="p">,</span>
                 <span class="s">"comment"</span> <span class="p">:</span> <span class="s">"DBpedia"</span><span class="p">,</span>
                 <span class="s">"label"</span> <span class="p">:</span> <span class="s">"DBpedia"</span><span class="p">},</span>
               <span class="n">new_db</span><span class="p">)</span>
</code></pre></div></div><p>If you’ve managed to get this downloaded, you can use the same client for the remaining queries.</p><p>In the python SDK, you can get a single edge as follows:</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">result</span> <span class="o">=</span> <span class="n">WQ</span><span class="p">().</span><span class="n">limit</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="n">triple</span><span class="p">(</span><span class="s">"v:X"</span><span class="p">,</span> <span class="s">"v:P"</span><span class="p">,</span> <span class="s">"v:Y"</span><span class="p">).</span><span class="n">execute</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
</code></pre></div></div><p>This query asks for <em>every</em> edge in the graph, limiting to the first 10 results.</p><p>The <code class="highlighter-rouge">v:</code> means that <code class="highlighter-rouge">X</code>, <code class="highlighter-rouge">P</code>, and <code class="highlighter-rouge">Y</code> are considered to be variables.</p><p>As it turns out, the first results are edges that have to do with the American punk band “chk-chk-chk” (or <code class="highlighter-rouge">!!!</code>).</p><p>The result of the query is the following <em>typical</em> binding return form:</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="s">'@type'</span><span class="p">:</span> <span class="s">'api:WoqlResponse'</span><span class="p">,</span>
 <span class="s">'api:status'</span><span class="p">:</span> <span class="s">'api:success'</span><span class="p">,</span>
 <span class="s">'api:variable_names'</span><span class="p">:</span> <span class="p">[</span><span class="s">'X'</span><span class="p">,</span> <span class="s">'P'</span><span class="p">,</span> <span class="s">'Y'</span><span class="p">],</span>
 <span class="s">'bindings'</span><span class="p">:</span> <span class="p">[{</span><span class="s">'P'</span><span class="p">:</span> <span class="s">'http://dbpedia.org/ontology/activeYearsStartYear'</span><span class="p">,</span>
               <span class="s">'X'</span><span class="p">:</span> <span class="s">'http://dbpedia.org/resource/!!!'</span><span class="p">,</span>
               <span class="s">'Y'</span><span class="p">:</span> <span class="p">{</span><span class="s">'@type'</span><span class="p">:</span> <span class="s">'http://www.w3.org/2001/XMLSchema#gYear'</span><span class="p">,</span>
                     <span class="s">'@value'</span><span class="p">:</span> <span class="s">'1996'</span><span class="p">}},</span>
              <span class="p">{</span><span class="s">'P'</span><span class="p">:</span> <span class="s">'http://dbpedia.org/ontology/alias'</span><span class="p">,</span>
               <span class="s">'X'</span><span class="p">:</span> <span class="s">'http://dbpedia.org/resource/!!!'</span><span class="p">,</span>
               <span class="s">'Y'</span><span class="p">:</span> <span class="p">{</span><span class="s">'@language'</span><span class="p">:</span> <span class="s">'en'</span><span class="p">,</span> <span class="s">'@value'</span><span class="p">:</span> <span class="s">'Chk Chk Chk'</span><span class="p">}},</span>
              <span class="p">{</span><span class="s">'P'</span><span class="p">:</span> <span class="s">'http://dbpedia.org/ontology/associatedBand'</span><span class="p">,</span>
               <span class="s">'X'</span><span class="p">:</span> <span class="s">'http://dbpedia.org/resource/!!!'</span><span class="p">,</span>
               <span class="s">'Y'</span><span class="p">:</span> <span class="s">'http://dbpedia.org/resource/Maserati_(band)'</span><span class="p">},</span>
              <span class="p">{</span><span class="s">'P'</span><span class="p">:</span> <span class="s">'http://dbpedia.org/ontology/associatedBand'</span><span class="p">,</span>
               <span class="s">'X'</span><span class="p">:</span> <span class="s">'http://dbpedia.org/resource/!!!'</span><span class="p">,</span>
               <span class="s">'Y'</span><span class="p">:</span> <span class="s">'http://dbpedia.org/resource/Out_Hud'</span><span class="p">}],</span>
    <span class="s">'deletes'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s">'inserts'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s">'transaction_retry_count'</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div></div><p>This object has a number of features. The first is the <code class="highlighter-rouge">@type</code> which states that this is the result of a WOQL query. The second is that it was successful (rather than an error).</p><p>The third field is where it starts to get interesting. Here we have the variables which were bound in the query. These variables are <em>in-order</em>, in a way that can be fixed with the <code class="highlighter-rouge">WQ().select</code> call or simply by the in-order use in the query.</p><p>The next field is the most important. The <code class="highlighter-rouge">bindings</code> hold the variable values for each solution to the query. If you are familiar with SQL you can think of this as the rows of the query solution.</p><p>Finally you find <code class="highlighter-rouge">deletes</code>, <code class="highlighter-rouge">inserts</code> and <code class="highlighter-rouge">transaction_retry_count</code>, all of which have to do with <em>updates</em> to the graph.</p><p>The bindings are of two different types. Those that end with a <em>node</em> and those that end with a <em>literal</em>. Nodes are represented by URIs, such as the final result: <code class="highlighter-rouge">'http://dbpedia.org/resource/Out_Hud'</code>. Values are represented by a dictionary that gives the <em>type</em> as <code class="highlighter-rouge">@type</code> and the <em>value</em> as <code class="highlighter-rouge">@value</code>.</p><h2 id="connect-the-dots"> <a href="#connect-the-dots" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Connect the dots</h2><p>Nodes can appear at either the beginning of an edge, or at the end of an edge. We can chain such edges together as follows:</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">result2</span> <span class="o">=</span> <span class="n">WQ</span><span class="p">().</span><span class="n">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">woql_and</span><span class="p">(</span>
  <span class="n">WQ</span><span class="p">().</span><span class="n">triple</span><span class="p">(</span><span class="s">"v:Original_Band"</span><span class="p">,</span><span class="s">"scm:associatedBand"</span><span class="p">,</span><span class="s">"v:Associated_Band"</span><span class="p">),</span>
  <span class="n">WQ</span><span class="p">().</span><span class="n">triple</span><span class="p">(</span><span class="s">"v:Associated_Band"</span><span class="p">,</span><span class="s">"scm:associatedBand"</span><span class="p">,</span><span class="s">"v:Two_Hop_Band"</span><span class="p">)</span>
<span class="p">).</span><span class="n">execute</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
</code></pre></div></div><p>This query finds the first result of an associated band that also has an associated band. This kind of query is where graph-databases really shine - the multihop query. We say that we want to follow one edge, and then the next by reusing the variable name <code class="highlighter-rouge">"v:Associated_Band"</code> twice.</p><p>Visually you might think of this as:</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"V:Original_Band" - "scm:associatedBand"-&gt; "v:Associated_Band" -scm:associatedBand"-&gt; "v:Two_Hop_Band"
</code></pre></div></div><p>We say that the two <code class="highlighter-rouge">"v:Associated_Band"</code> variables <em>unify</em>. That is, we treat the variables as the same element in every solution whenever the same variable is used repeatedly.</p><p>But if you look at the results, you’ll see that we’ve actually just gone and found <code class="highlighter-rouge">!!!</code> again. This isn’t surprising since one would expect the notion of an “associated” band to be reflexive. Two different variables are not required to have <em>different values</em>.</p><p>We can specify that we don’t want to see the same value in the two different variables with the following query:</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">result2</span> <span class="o">=</span> <span class="n">WQ</span><span class="p">().</span><span class="n">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">woql_and</span><span class="p">(</span>
  <span class="n">WQ</span><span class="p">().</span><span class="n">triple</span><span class="p">(</span><span class="s">"v:Original_Band"</span><span class="p">,</span><span class="s">"scm:associatedBand"</span><span class="p">,</span><span class="s">"v:Associated_Band"</span><span class="p">),</span>
  <span class="n">WQ</span><span class="p">().</span><span class="n">triple</span><span class="p">(</span><span class="s">"v:Associated_Band"</span><span class="p">,</span><span class="s">"scm:associatedBand"</span><span class="p">,</span><span class="s">"v:Two_Hop_Band"</span><span class="p">),</span>
  <span class="n">WQ</span><span class="p">().</span><span class="n">woql_not</span><span class="p">().</span><span class="n">eq</span><span class="p">(</span><span class="s">"v:Two_Hop_Band"</span><span class="p">,</span> <span class="s">"v:Original_Band"</span><span class="p">)</span>
<span class="p">).</span><span class="n">execute</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
</code></pre></div></div><p>This query asks for any two-hop-band which isn’t the original band.</p><p>Now the result for our <code class="highlighter-rouge">"v:Two_Hop_Band"</code> is <code class="highlighter-rouge">'http://dbpedia.org/resource/Headlights_(band)'</code> which is a less degenerate answer.</p><h2 id="paths"> <a href="#paths" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Paths</h2><p>The above approach allows us to make arbitrary graph shapes by simply naming various nodes of the graph with the same variable. However, we can only specify shapes which we know completely.</p><p>What if we want to answer a general question, such as, what bands can I reach in N hops. We could of course make a separate query for each of the N hop solutions, but more convenient is to use a <code class="highlighter-rouge">path</code> query.</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">result3</span> <span class="o">=</span> <span class="n">WQ</span><span class="p">().</span><span class="n">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">path</span><span class="p">(</span>
            <span class="s">"v:Original_Band"</span><span class="p">,</span>
            <span class="s">"scm:associatedBand+"</span><span class="p">,</span>
            <span class="s">"v:Final_Band"</span><span class="p">,</span>
            <span class="s">"v:Path"</span>
        <span class="p">).</span><span class="n">execute</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
</code></pre></div></div><p>This query will bind <code class="highlighter-rouge">Original_Band</code> and <code class="highlighter-rouge">Final_Band</code> to any bands that are connected by any number of hops on <code class="highlighter-rouge">scm:associateBand</code>, greater than 1. We follow a syntax which should be familiar to anyone who has used regular expressions, and which includes grouping: <code class="highlighter-rouge">(my_pattern)</code>, wildcards: <code class="highlighter-rouge">foo*</code> or <code class="highlighter-rouge">foo+</code> and disjunction <code class="highlighter-rouge">foo|bar</code>.</p><p>The path query also stores the result of the path in <code class="highlighter-rouge">Path</code>, the final argument. This allows you not only to know that the nodes are connected, but <em>how</em> they are connect.</p><h2 id="updates-and-inserts"> <a href="#updates-and-inserts" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Updates and Inserts</h2><p>No database query language is complete without the ability to change the stored data. You can add yourself to the DBpedia database with a query similar to the following:</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">WQ</span><span class="p">().</span><span class="n">add_triple</span><span class="p">(</span><span class="s">"doc:joe_murphy"</span><span class="p">,</span> <span class="s">"scm:name"</span><span class="p">,</span> <span class="s">"Joe Murphy"</span><span class="p">).</span><span class="n">execute</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
</code></pre></div></div><p>This will create a resource on the default prefix base with the default schema predicate named <code class="highlighter-rouge">name</code>, and having the concrete string value “Joe Murphy”.</p><p>But if you don’t want it to be there anymore, you can remove it.</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">WQ</span><span class="p">().</span><span class="n">delete_triple</span><span class="p">(</span><span class="s">"doc:joe_murphy"</span><span class="p">,</span> <span class="s">"scm:name"</span><span class="p">,</span> <span class="s">"Joe Murphy"</span><span class="p">).</span><span class="n">execute</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
</code></pre></div></div><p>And if you added <code class="highlighter-rouge">"doc:joe_murphy"</code> and couldn’t remember what name he had, you could delete it as follows:</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">WQ</span><span class="p">().</span><span class="n">woql_and</span><span class="p">(</span>
   <span class="n">WQ</span><span class="p">().</span><span class="n">triple</span><span class="p">(</span><span class="s">"doc:joe_murphy"</span><span class="p">,</span> <span class="s">"scm:name"</span><span class="p">,</span> <span class="s">"v:X"</span><span class="p">),</span>
   <span class="n">WQ</span><span class="p">().</span><span class="n">delete_triple</span><span class="p">(</span><span class="s">"doc:joe_murphy"</span><span class="p">,</span> <span class="s">"scm:name"</span><span class="p">,</span> <span class="s">"v:X"</span><span class="p">)</span>
<span class="p">).</span><span class="n">execute</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
</code></pre></div></div><p>You can in fact search for arbitrary bindings, and delete or insert based on them.</p><h2 id="casting"> <a href="#casting" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Casting</h2><p>Sometimes a thing is not the type you want it to be. In certain cases we can cast data between the various types so we can get the object we want.</p><p>For instance, if we have a string and want a date, we can put it in ISO format and make a cast:</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">WQ</span><span class="p">().</span><span class="n">typecast</span><span class="p">(</span><span class="s">"2020-12-24T00:00:00"</span><span class="p">,</span> <span class="s">"xsd:dateTime"</span><span class="p">,</span> <span class="s">"v:Date"</span><span class="p">).</span><span class="n">execute</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
</code></pre></div></div><p>If the typecast is impossible, the query will fail with error (of type <code class="highlighter-rouge">vio:ViolationWithDatatypeObject</code>). You can see with the result with the following:</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">WQ</span><span class="p">().</span><span class="n">typecast</span><span class="p">(</span><span class="s">"20-12-24T00:00:00"</span><span class="p">,</span> <span class="s">"xsd:dateTime"</span><span class="p">,</span> <span class="s">"v:Date"</span><span class="p">).</span><span class="n">execute</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
</code></pre></div></div><h2 id="string-matching"> <a href="#string-matching" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> String Matching</h2><p>The python SDK for WOQL allows basical string matching as well. You can search for an object which has a property with a given string as follows:</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">WQ</span><span class="p">().</span><span class="n">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">woql_and</span><span class="p">(</span>
    <span class="n">WQ</span><span class="p">().</span><span class="n">triple</span><span class="p">(</span><span class="s">"v:X"</span><span class="p">,</span> <span class="s">"scm:name"</span><span class="p">,</span> <span class="s">"v:Y"</span><span class="p">),</span>
    <span class="n">WQ</span><span class="p">().</span><span class="n">re</span><span class="p">(</span><span class="s">".*cholera.*"</span><span class="p">,</span> <span class="s">"v:Y"</span><span class="p">,</span> <span class="p">[</span><span class="s">"v:All"</span><span class="p">])</span>
  <span class="p">).</span><span class="n">execute</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
</code></pre></div></div><p>This will let you search for an arbitrary regexp in the last value of a string. In the DBpedia dataset, this gives you back the node: <code class="highlighter-rouge">http://dbpedia.org/resource/1817–1824_cholera_pandemic</code> which you can then investigate further.</p><p>You can use arbitrary regular expressions and the matching groups will be bound to the variables in the final list of <code class="highlighter-rouge">re</code>.</p><h2 id="string-manipulation"> <a href="#string-manipulation" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> String manipulation</h2><p>But we might not have the data in a format that we can cast yet. Supposing we are given the date in a different order and extracted from slightly messy text. We’ll set this situation by binding <code class="highlighter-rouge">"v:Date_String"</code> to <code class="highlighter-rouge">" 12-24-2004 "</code>.</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">WQ</span><span class="p">().</span><span class="n">woql_and</span><span class="p">(</span>
        <span class="n">WQ</span><span class="p">().</span><span class="n">eq</span><span class="p">(</span><span class="s">"v:Date_String"</span><span class="p">,</span> <span class="s">" 12-24-2004 "</span><span class="p">),</span>
        <span class="n">WQ</span><span class="p">().</span><span class="n">trim</span><span class="p">(</span><span class="s">"v:Date_String"</span><span class="p">,</span> <span class="s">"v:Date_String_Trimmed"</span><span class="p">),</span>
        <span class="n">WQ</span><span class="p">().</span><span class="n">re</span><span class="p">(</span><span class="s">"(\d\d)-(\d\d)-(\d\d\d\d)"</span><span class="p">,</span> <span class="s">"v:Date_String_Trimmed"</span><span class="p">,</span>
                <span class="p">[</span><span class="s">"v:All"</span><span class="p">,</span> <span class="s">"v:Month"</span><span class="p">,</span> <span class="s">"v:Day"</span><span class="p">,</span> <span class="s">"v:Year"</span><span class="p">]),</span>
        <span class="n">WQ</span><span class="p">().</span><span class="n">concat</span><span class="p">([</span><span class="s">"v:Year"</span><span class="p">,</span> <span class="s">"-"</span><span class="p">,</span> <span class="s">"v:Month"</span><span class="p">,</span> <span class="s">"-"</span><span class="p">,</span> <span class="s">"v:Day"</span><span class="p">],</span> <span class="s">"v:YMD"</span><span class="p">),</span>
        <span class="n">WQ</span><span class="p">().</span><span class="n">concat</span><span class="p">([</span><span class="s">'v:YMD'</span><span class="p">,</span> <span class="s">'T00:00:00'</span><span class="p">],</span> <span class="s">"v:ISO"</span><span class="p">),</span>
        <span class="n">WQ</span><span class="p">().</span><span class="n">typecast</span><span class="p">(</span><span class="s">"v:ISO"</span><span class="p">,</span> <span class="s">"xsd:dateTime"</span><span class="p">,</span> <span class="s">"v:Date"</span><span class="p">)</span>
<span class="p">).</span><span class="n">execute</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
</code></pre></div></div><p>Now those of us who like to have their days and months in a sensible order (like the computer does) can read the date!</p><h2 id="mathematics"> <a href="#mathematics" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Mathematics</h2><p>You can also do basic mathematical manipulations.</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">WQ</span><span class="p">().</span><span class="nb">eval</span><span class="p">(</span><span class="n">WQ</span><span class="p">().</span><span class="n">plus</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="s">"v:X"</span><span class="p">).</span><span class="n">execute</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
</code></pre></div></div><p>This binds “v:X” to the result of the addition of <code class="highlighter-rouge">1</code> and <code class="highlighter-rouge">2</code>. You can use variables in place of <code class="highlighter-rouge">1</code> and <code class="highlighter-rouge">2</code> and re-use <code class="highlighter-rouge">"v:X"</code> in later queries. For instance we could write:</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">WQ</span><span class="p">().</span><span class="n">woql_and</span><span class="p">(</span>
    <span class="n">WQ</span><span class="p">().</span><span class="nb">eval</span><span class="p">(</span><span class="n">WQ</span><span class="p">().</span><span class="n">times</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="s">"v:Product"</span><span class="p">),</span>
    <span class="n">WQ</span><span class="p">().</span><span class="nb">eval</span><span class="p">(</span><span class="n">WQ</span><span class="p">().</span><span class="n">div</span><span class="p">(</span><span class="s">"v:Product"</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="s">"v:Result"</span><span class="p">)</span>
<span class="p">).</span><span class="n">execute</span><span class="p">(</span><span class="n">client</span><span class="p">),</span>
</code></pre></div></div><p>Here of course we get back the number <code class="highlighter-rouge">3</code> as we’d expect. The complete definition of mathematical operators is in the python-client reference documentation.</p><h2 id="conclusion"> <a href="#conclusion" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Conclusion</h2><p>With this bag of tricks, you should be able to wrangle more data into a form you want for data-curation tasks before running analysis, machine-learning or simply browsing over your information.</p><hr><footer role="contentinfo"><p class="text-small text-grey-dk-000 mb-0">Copyright &copy; 2020 - TerminusDB | Distributed by an <a href="https://github.com/terminusdb/terminusdb-server/blob/master/LICENSE">GPL-3.0 license.</a></p></footer></div></div></div></div><script> var o = document.querySelector(".header"), i = document.querySelector(".menu__body"), a = document.querySelector("#burger"); a && a.addEventListener("click", function () { a.classList.toggle("active"), o.classList.toggle("active"), i.classList.toggle("active"); }); window.addEventListener('resize',function(){ a.classList.remove("active"), o.classList.remove("active"), i.classList.remove("active"); }) </script>
